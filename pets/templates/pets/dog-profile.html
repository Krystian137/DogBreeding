{% extends "base.html" %}
{% load static %}

{% block title %}{{ dog.name }} - Costa Rizada{% endblock %}

{% block header_content %}
    <h1>{{ dog.name }}</h1>
    <span class="subheading">
        {{ dog.get_gender_display }} • {{ dog.age }}
    </span>
{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/dogs.css' %}">
{% endblock %}

{% block content %}
<div class="dog-profile-container">
    <div class="dog-profile-card">
        <!-- Główne zdjęcie -->
        <div class="dog-profile-hero">
            {% if dog.main_photo %}
                <img src="{{ dog.main_photo.image.url }}" 
                     alt="{{ dog.name }}"
                     loading="lazy">
            {% elif dog.photos.first %}
                <img src="{{ dog.photos.first.image.url }}" 
                     alt="{{ dog.name }}"
                     loading="lazy">
            {% else %}
                <div class="dog-hero-placeholder">
                    <span>{% if dog.gender == 'M' %}♂{% else %}♀{% endif %}</span>
                </div>
            {% endif %}

            <!-- Badge statusu
            <div class="dog-status-badge">
                {% if dog.status == 'available' %}
                    <span class="badge-available">Dostępny</span>
                {% elif dog.status == 'reserved' %}
                    <span class="badge-reserved">Zarezerwowany</span>
                {% elif dog.status == 'sold' %}
                    <span class="badge-sold">Sprzedany</span>
                {% elif dog.status == 'stayed' %}
                    <span class="badge-stayed">W hodowli</span>
                {% endif %}
            </div>
             -->

            <!-- Badge płci -->
            <div class="dog-gender-badge-hero">
                {% if dog.gender == 'M' %}
                    <span class="badge-male-hero">♂ {{ dog.get_gender_display }}</span>
                {% else %}
                    <span class="badge-female-hero">♀ {{ dog.get_gender_display }}</span>
                {% endif %}
            </div>
        </div>

        <!-- Treść profilu -->
        <div class="dog-profile-content">
            <!-- Nagłówek -->
            <div class="profile-header-dog">
                <h1 class="profile-name-dog">{{ dog.name }}</h1>
            </div>

            <!-- Informacje podstawowe - elegancka tabela -->
            <div class="dog-info-section">
                <h3 class="section-title-dog">Informacje podstawowe</h3>

                <div class="info-table">
                    <div class="info-row">
                        <span class="info-label">Płeć</span>
                        <span class="info-value">{{ dog.get_gender_display }}</span>
                    </div>

                    {% if dog.age %}
                    <div class="info-row">
                        <span class="info-label">Wiek</span>
                        <span class="info-value">{{ dog.age }}</span>
                    </div>
                    {% endif %}

                    {% if dog.color %}
                    <div class="info-row">
                        <span class="info-label">Umaszczenie</span>
                        <span class="info-value">{{ dog.color }}</span>
                    </div>
                    {% endif %}

                    {% if dog.weight %}
                    <div class="info-row">
                        <span class="info-label">Waga</span>
                        <span class="info-value">{{ dog.weight }} kg</span>
                    </div>
                    {% endif %}

                    {% if dog.height %}
                    <div class="info-row">
                        <span class="info-label">Wzrost</span>
                        <span class="info-value">{{ dog.height }} cm</span>
                    </div>
                    {% endif %}
                    <!-- Div for dog status
                    <div class="info-row">
                        <span class="info-label">Status</span>
                        <span class="info-value status-inline">
                            {% if dog.status == 'available' %}
                                <span class="status-dot status-dot-available"></span> Dostępny
                            {% elif dog.status == 'reserved' %}
                                <span class="status-dot status-dot-reserved"></span> Zarezerwowany
                            {% elif dog.status == 'sold' %}
                                <span class="status-dot status-dot-sold"></span> Sprzedany
                            {% elif dog.status == 'stayed' %}
                                <span class="status-dot status-dot-stayed"></span> W hodowli
                            {% endif %}
                        </span>
                    </div>
                    -->
                    {% if dog.litter %}
                    <div class="info-row">
                        <span class="info-label">Miot</span>
                        <span class="info-value">
                            <a href="{% url 'zwierzaki:LitterDetails' slug=dog.litter.slug %}" class="info-link">
                                {{ dog.litter.name }}
                            </a>
                        </span>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Drzewo genealogiczne -->
            {% if dog.litter %}
            <div class="pedigree-section">
                <h3 class="section-title-dog">Rodowód</h3>

                <div class="pedigree-tree">
                    <!-- Poziom 0: Przeglądany pies -->
                    <div class="pedigree-level pedigree-level-0">
                        <div class="pedigree-dog pedigree-current">
                            <div class="pedigree-name">{{ dog.name }}</div>
                            <div class="pedigree-details">Bieżący</div>
                        </div>
                    </div>

                    <!-- Poziom 1: Rodzice -->
                    {% if dog.litter.mother or dog.litter.father %}
                    <div class="pedigree-level pedigree-level-1">
                        <!-- Matka -->
                        {% if dog.litter.mother %}
                        <div class="pedigree-dog pedigree-parent pedigree-mother" data-dog-id="{{ dog.litter.mother.id }}">
                            <div class="pedigree-name">{{ dog.litter.mother.name }}</div>
                            <div class="pedigree-details">♀ Matka</div>

                            <!-- Hover popup -->
                            <div class="pedigree-popup">
                                {% if dog.litter.mother.main_photo %}
                                <img src="{{ dog.litter.mother.main_photo.image.url }}" alt="{{ dog.litter.mother.name }}">
                                {% elif dog.litter.mother.photos.first %}
                                <img src="{{ dog.litter.mother.photos.first.image.url }}" alt="{{ dog.litter.mother.name }}">
                                {% endif %}
                                <div class="popup-info">
                                    <strong>{{ dog.litter.mother.name }}</strong>
                                    <span>{{ dog.litter.mother.get_gender_display }}</span>
                                    {% if dog.litter.mother.color %}
                                    <span>{{ dog.litter.mother.color }}</span>
                                    {% endif %}
                                    <a href="{% url 'zwierzaki:DogProfile' slug=dog.litter.mother.slug %}" class="popup-link">Zobacz profil →</a>
                                </div>
                            </div>
                        </div>
                        {% else %}
                        <div class="pedigree-dog pedigree-unknown">
                            <div class="pedigree-name">—</div>
                            <div class="pedigree-details">♀ Matka</div>
                        </div>
                        {% endif %}

                        <!-- Ojciec -->
                        {% if dog.litter.father %}
                        <div class="pedigree-dog pedigree-parent pedigree-father" data-dog-id="{{ dog.litter.father.id }}">
                            <div class="pedigree-name">{{ dog.litter.father.name }}</div>
                            <div class="pedigree-details">♂ Ojciec</div>

                            <!-- Hover popup -->
                            <div class="pedigree-popup">
                                {% if dog.litter.father.main_photo %}
                                <img src="{{ dog.litter.father.main_photo.image.url }}" alt="{{ dog.litter.father.name }}">
                                {% elif dog.litter.father.photos.first %}
                                <img src="{{ dog.litter.father.photos.first.image.url }}" alt="{{ dog.litter.father.name }}">
                                {% endif %}
                                <div class="popup-info">
                                    <strong>{{ dog.litter.father.name }}</strong>
                                    <span>{{ dog.litter.father.get_gender_display }}</span>
                                    {% if dog.litter.father.color %}
                                    <span>{{ dog.litter.father.color }}</span>
                                    {% endif %}
                                    <a href="{% url 'zwierzaki:DogProfile' slug=dog.litter.father.slug %}" class="popup-link">Zobacz profil →</a>
                                </div>
                            </div>
                        </div>
                        {% else %}
                        <div class="pedigree-dog pedigree-unknown">
                            <div class="pedigree-name">—</div>
                            <div class="pedigree-details">♂ Ojciec</div>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}

                    <!-- Poziom 2: Dziadkowie -->
                    {% if dog.litter.mother.litter or dog.litter.father.litter %}
                    <div class="pedigree-level pedigree-level-2">
                        <!-- Dziadkowie ze strony matki -->
                        {% if dog.litter.mother.litter %}
                            {% if dog.litter.mother.litter.mother %}
                            <div class="pedigree-dog pedigree-grandparent">
                                <div class="pedigree-name">{{ dog.litter.mother.litter.mother.name }}</div>
                                <div class="pedigree-details">♀ Babcia</div>
                            </div>
                            {% else %}
                            <div class="pedigree-dog pedigree-unknown"><div class="pedigree-name">—</div></div>
                            {% endif %}

                            {% if dog.litter.mother.litter.father %}
                            <div class="pedigree-dog pedigree-grandparent">
                                <div class="pedigree-name">{{ dog.litter.mother.litter.father.name }}</div>
                                <div class="pedigree-details">♂ Dziadek</div>
                            </div>
                            {% else %}
                            <div class="pedigree-dog pedigree-unknown"><div class="pedigree-name">—</div></div>
                            {% endif %}
                        {% else %}
                            <div class="pedigree-dog pedigree-unknown"><div class="pedigree-name">—</div></div>
                            <div class="pedigree-dog pedigree-unknown"><div class="pedigree-name">—</div></div>
                        {% endif %}

                        <!-- Dziadkowie ze strony ojca -->
                        {% if dog.litter.father.litter %}
                            {% if dog.litter.father.litter.mother %}
                            <div class="pedigree-dog pedigree-grandparent">
                                <div class="pedigree-name">{{ dog.litter.father.litter.mother.name }}</div>
                                <div class="pedigree-details">♀ Babcia</div>
                            </div>
                            {% else %}
                            <div class="pedigree-dog pedigree-unknown"><div class="pedigree-name">—</div></div>
                            {% endif %}

                            {% if dog.litter.father.litter.father %}
                            <div class="pedigree-dog pedigree-grandparent">
                                <div class="pedigree-name">{{ dog.litter.father.litter.father.name }}</div>
                                <div class="pedigree-details">♂ Dziadek</div>
                            </div>
                            {% else %}
                            <div class="pedigree-dog pedigree-unknown"><div class="pedigree-name">—</div></div>
                            {% endif %}
                        {% else %}
                            <div class="pedigree-dog pedigree-unknown"><div class="pedigree-name">—</div></div>
                            <div class="pedigree-dog pedigree-unknown"><div class="pedigree-name">—</div></div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Opis -->
            {% if dog.description %}
            <div class="dog-description-section">
                <h3 class="section-title-dog">O {{ dog.name }}</h3>
                <div class="description-content-dog">
                    {{ dog.description|linebreaks }}
                </div>
            </div>
            {% endif %}

            <!-- Szczepienia -->
            {% if dog.vaccinations %}
            <div class="dog-vaccinations-section">
                <h3 class="section-title-dog">Szczepienia</h3>
                <div class="vaccinations-content">
                    {{ dog.vaccinations|linebreaks }}
                </div>
            </div>
            {% endif %}

            <!-- Osiągnięcia -->
            {% if dog.achievements %}
            <div class="dog-achievements-section">
                <h3 class="section-title-dog">Osiągnięcia</h3>
                <div class="achievements-content">
                    {{ dog.achievements|linebreaks }}
                </div>
            </div>
            {% endif %}

            <!-- Galeria zdjęć -->
            {% if dog.photos.all|length > 1 %}
            <div class="dog-gallery-section">
                <h3 class="section-title-dog">Galeria zdjęć</h3>
                <div class="gallery-grid-dog">
                    {% for photo in dog.photos.all %}
                        {% if photo != dog.main_photo %}
                        <div class="gallery-item-dog">
                            <img src="{{ photo.image.url }}"
                                 alt="{{ dog.name }}"
                                 loading="lazy">
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Akcje -->
            <div class="profile-actions-dog">
                <a href="{% url 'zwierzaki:DogList' %}" class="btn-back-dog">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M12 8a.5.5 0 0 1-.5.5H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5a.5.5 0 0 1 .5.5z"/>
                    </svg>
                    Powrót do listy psów
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}