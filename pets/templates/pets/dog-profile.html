{% extends "base.html" %}
{% load static %}

{% block title %}{{ dog.name }} - Costa Rizada{% endblock %}

{% block header_content %}
    <h1>{{ dog.name }}</h1>
    <span class="subheading">
        {{ dog.get_gender_display }} ‚Ä¢ {{ dog.age }}
    </span>
{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/dogs.css' %}">
{% endblock %}

{% block content %}
<div class="dog-profile-container">
    <div class="dog-profile-card">
        <!-- Main Photo  -->
        <div class="dog-profile-hero">
            {% if dog.main_photo %}
                <img src="{{ dog.main_photo.image.url }}" 
                     alt="{{ dog.name }}"
                     loading="lazy">
            {% elif dog.photos.first %}
                <img src="{{ dog.photos.first.image.url }}" 
                     alt="{{ dog.name }}"
                     loading="lazy">
            {% else %}
                <div class="dog-hero-placeholder">
                    <span>{% if dog.gender == 'M' %}‚ôÇ{% else %}‚ôÄ{% endif %}</span>
                </div>
            {% endif %}

            <!-- Badge - gender -->
            <div class="dog-gender-badge-hero">
                {% if dog.gender == 'M' %}
                    <span class="badge-male-hero">‚ôÇ {{ dog.get_gender_display }}</span>
                {% else %}
                    <span class="badge-female-hero">‚ôÄ {{ dog.get_gender_display }}</span>
                {% endif %}
            </div>
        </div>

        <!-- Profile content -->
        <div class="dog-profile-content">
            <!-- Name -->
            <div class="profile-header-dog">
                <h1 class="profile-name-dog">{{ dog.name }}</h1>
            </div>

            <!-- Table with dog information -->
            <div class="dog-info-section">
                <h3 class="section-title-dog">Informacje podstawowe</h3>

                <div class="info-grid">
                    <div class="info-card">
                        <span class="info-icon">‚ôÇ‚ôÄ</span>
                        <span class="info-card-label">P≈Çeƒá</span>
                        <span class="info-card-value">{{ dog.get_gender_display }}</span>
                    </div>

                    {% if dog.age %}
                    <div class="info-card">
                        <span class="info-icon">üéÇ</span>
                        <span class="info-card-label">Wiek</span>
                        <span class="info-card-value">{{ dog.age }}</span>
                    </div>
                    {% endif %}

                    {% if dog.weight %}
                    <div class="info-card">
                        <span class="info-icon">‚öñÔ∏è</span>
                        <span class="info-card-label">Waga</span>
                        <span class="info-card-value">{{ dog.weight }} kg</span>
                    </div>
                    {% endif %}

                    {% if dog.height %}
                    <div class="info-card">
                        <span class="info-icon">üìè</span>
                        <span class="info-card-label">Wzrost</span>
                        <span class="info-card-value">{{ dog.height }} cm</span>
                    </div>
                    {% endif %}
                </div>

                <div class="info-table-full">
                    {% if dog.color %}
                    <div class="info-row-full">
                        <span class="info-label">Umaszczenie</span>
                        <span class="info-value">{{ dog.color }}</span>
                    </div>
                    {% endif %}

                    {% if dog.litter %}
                    <div class="info-row-full">
                        <span class="info-label">Miot</span>
                        <span class="info-value">
                            <a href="{% url 'zwierzaki:LitterDetails' slug=dog.litter.slug %}" class="info-link">
                                {{ dog.litter.name }}
                            </a>
                        </span>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Genealogical Tree -->
            {% if dog.get_mother or dog.get_father %}
            <div class="pedigree-section">
                <h3 class="section-title-dog">Rodow√≥d</h3>

                <div class="pedigree-tree">
                    <!-- 0: Current Dog -->
                    <div class="pedigree-level pedigree-level-0">
                        <div class="pedigree-dog pedigree-current">
                            <div class="pedigree-name">{{ dog.name }}</div>
                            <div class="pedigree-details">Bie≈ºƒÖcy</div>
                        </div>
                    </div>

                    <!-- 1: Parents -->
                    <div class="pedigree-level pedigree-level-1">
                        <!-- Mother -->
                        {% if dog.get_mother %}
                        <a href="{% url 'zwierzaki:DogProfile' slug=dog.get_mother.slug %}" class="pedigree-dog pedigree-parent pedigree-mother pedigree-clickable" data-dog-id="{{ dog.get_mother.id }}">
                            <div class="pedigree-name">{{ dog.get_mother.name }}</div>
                            <div class="pedigree-details">‚ôÄ Matka</div>

                            <!-- Hover popup -->
                            <div class="pedigree-popup">
                                {% if dog.get_mother.main_photo %}
                                <img src="{{ dog.get_mother.main_photo.image.url }}" alt="{{ dog.get_mother.name }}">
                                {% elif dog.get_mother.photos.first %}
                                <img src="{{ dog.get_mother.photos.first.image.url }}" alt="{{ dog.get_mother.name }}">
                                {% endif %}
                                <div class="popup-info">
                                    <strong>{{ dog.get_mother.name }}</strong>
                                    <span>{{ dog.get_mother.get_gender_display }}</span>
                                    {% if dog.get_mother.color %}
                                    <span>{{ dog.get_mother.color }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </a>
                        {% else %}
                        <div class="pedigree-dog pedigree-unknown">
                            <div class="pedigree-name">‚Äî</div>
                            <div class="pedigree-details">‚ôÄ Matka</div>
                        </div>
                        {% endif %}

                        <!-- Father -->
                        {% if dog.get_father %}
                        <a href="{% url 'zwierzaki:DogProfile' slug=dog.get_father.slug %}" class="pedigree-dog pedigree-parent pedigree-father pedigree-clickable" data-dog-id="{{ dog.get_father.id }}">
                            <div class="pedigree-name">{{ dog.get_father.name }}</div>
                            <div class="pedigree-details">‚ôÇ Ojciec</div>

                            <!-- Hover popup -->
                            <div class="pedigree-popup">
                                {% if dog.get_father.main_photo %}
                                <img src="{{ dog.get_father.main_photo.image.url }}" alt="{{ dog.get_father.name }}">
                                {% elif dog.get_father.photos.first %}
                                <img src="{{ dog.get_father.photos.first.image.url }}" alt="{{ dog.get_father.name }}">
                                {% endif %}
                                <div class="popup-info">
                                    <strong>{{ dog.get_father.name }}</strong>
                                    <span>{{ dog.get_father.get_gender_display }}</span>
                                    {% if dog.get_father.color %}
                                    <span>{{ dog.get_father.color }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </a>
                        {% else %}
                        <div class="pedigree-dog pedigree-unknown">
                            <div class="pedigree-name">‚Äî</div>
                            <div class="pedigree-details">‚ôÇ Ojciec</div>
                        </div>
                        {% endif %}
                    </div>

                    <!-- 2: Grandparents -->
                    {% if dog.get_maternal_grandmother or dog.get_maternal_grandfather or dog.get_paternal_grandmother or dog.get_paternal_grandfather %}
                    <div class="pedigree-level pedigree-level-2 pedigree-grandparents-only">
                        <!-- Maternal Grandmother -->
                        {% if dog.get_maternal_grandmother %}
                        <a href="{% url 'zwierzaki:DogProfile' slug=dog.get_maternal_grandmother.slug %}" class="pedigree-dog pedigree-grandparent pedigree-clickable">
                            <div class="pedigree-name">{{ dog.get_maternal_grandmother.name }}</div>
                            <div class="pedigree-details">‚ôÄ Babcia</div>

                            <!-- Hover popup -->
                            <div class="pedigree-popup">
                                {% if dog.get_maternal_grandmother.main_photo %}
                                <img src="{{ dog.get_maternal_grandmother.main_photo.image.url }}" alt="{{ dog.get_maternal_grandmother.name }}">
                                {% elif dog.get_maternal_grandmother.photos.first %}
                                <img src="{{ dog.get_maternal_grandmother.photos.first.image.url }}" alt="{{ dog.get_maternal_grandmother.name }}">
                                {% endif %}
                                <div class="popup-info">
                                    <strong>{{ dog.get_maternal_grandmother.name }}</strong>
                                    <span>{{ dog.get_maternal_grandmother.get_gender_display }}</span>
                                    {% if dog.get_maternal_grandmother.color %}
                                    <span>{{ dog.get_maternal_grandmother.color }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </a>
                        {% else %}
                        <div class="pedigree-dog pedigree-unknown"><div class="pedigree-name">‚Äî</div></div>
                        {% endif %}

                        <!-- Maternal Grandfather -->
                        {% if dog.get_maternal_grandfather %}
                        <a href="{% url 'zwierzaki:DogProfile' slug=dog.get_maternal_grandfather.slug %}" class="pedigree-dog pedigree-grandparent pedigree-clickable">
                            <div class="pedigree-name">{{ dog.get_maternal_grandfather.name }}</div>
                            <div class="pedigree-details">‚ôÇ Dziadek</div>

                            <!-- Hover popup -->
                            <div class="pedigree-popup">
                                {% if dog.get_maternal_grandfather.main_photo %}
                                <img src="{{ dog.get_maternal_grandfather.main_photo.image.url }}" alt="{{ dog.get_maternal_grandfather.name }}">
                                {% elif dog.get_maternal_grandfather.photos.first %}
                                <img src="{{ dog.get_maternal_grandfather.photos.first.image.url }}" alt="{{ dog.get_maternal_grandfather.name }}">
                                {% endif %}
                                <div class="popup-info">
                                    <strong>{{ dog.get_maternal_grandfather.name }}</strong>
                                    <span>{{ dog.get_maternal_grandfather.get_gender_display }}</span>
                                    {% if dog.get_maternal_grandfather.color %}
                                    <span>{{ dog.get_maternal_grandfather.color }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </a>
                        {% else %}
                        <div class="pedigree-dog pedigree-unknown"><div class="pedigree-name">‚Äî</div></div>
                        {% endif %}

                        <!-- Paternal Grandmother -->
                        {% if dog.get_paternal_grandmother %}
                        <a href="{% url 'zwierzaki:DogProfile' slug=dog.get_paternal_grandmother.slug %}" class="pedigree-dog pedigree-grandparent pedigree-clickable">
                            <div class="pedigree-name">{{ dog.get_paternal_grandmother.name }}</div>
                            <div class="pedigree-details">‚ôÄ Babcia</div>

                            <!-- Hover popup -->
                            <div class="pedigree-popup">
                                {% if dog.get_paternal_grandmother.main_photo %}
                                <img src="{{ dog.get_paternal_grandmother.main_photo.image.url }}" alt="{{ dog.get_paternal_grandmother.name }}">
                                {% elif dog.get_paternal_grandmother.photos.first %}
                                <img src="{{ dog.get_paternal_grandmother.photos.first.image.url }}" alt="{{ dog.get_paternal_grandmother.name }}">
                                {% endif %}
                                <div class="popup-info">
                                    <strong>{{ dog.get_paternal_grandmother.name }}</strong>
                                    <span>{{ dog.get_paternal_grandmother.get_gender_display }}</span>
                                    {% if dog.get_paternal_grandmother.color %}
                                    <span>{{ dog.get_paternal_grandmother.color }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </a>
                        {% else %}
                        <div class="pedigree-dog pedigree-unknown"><div class="pedigree-name">‚Äî</div></div>
                        {% endif %}

                        <!-- Paternal Grandfather -->
                        {% if dog.get_paternal_grandfather %}
                        <a href="{% url 'zwierzaki:DogProfile' slug=dog.get_paternal_grandfather.slug %}" class="pedigree-dog pedigree-grandparent pedigree-clickable">
                            <div class="pedigree-name">{{ dog.get_paternal_grandfather.name }}</div>
                            <div class="pedigree-details">‚ôÇ Dziadek</div>

                            <!-- Hover popup -->
                            <div class="pedigree-popup">
                                {% if dog.get_paternal_grandfather.main_photo %}
                                <img src="{{ dog.get_paternal_grandfather.main_photo.image.url }}" alt="{{ dog.get_paternal_grandfather.name }}">
                                {% elif dog.get_paternal_grandfather.photos.first %}
                                <img src="{{ dog.get_paternal_grandfather.photos.first.image.url }}" alt="{{ dog.get_paternal_grandfather.name }}">
                                {% endif %}
                                <div class="popup-info">
                                    <strong>{{ dog.get_paternal_grandfather.name }}</strong>
                                    <span>{{ dog.get_paternal_grandfather.get_gender_display }}</span>
                                    {% if dog.get_paternal_grandfather.color %}
                                    <span>{{ dog.get_paternal_grandfather.color }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </a>
                        {% else %}
                        <div class="pedigree-dog pedigree-unknown"><div class="pedigree-name">‚Äî</div></div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Description -->
            {% if dog.description %}
            <div class="dog-description-section">
                <h3 class="section-title-dog">O {{ dog.name }}</h3>
                <div class="description-content-dog">
                    {{ dog.description|linebreaks }}
                </div>
            </div>
            {% endif %}

            <!-- Vaccinations -->
            {% if dog.vaccinations %}
            <div class="dog-vaccinations-section">
                <h3 class="section-title-dog">Szczepienia</h3>
                <div class="vaccinations-content">
                    {{ dog.vaccinations|linebreaks }}
                </div>
            </div>
            {% endif %}

            <!-- Achievements -->
            {% if dog.achievements %}
            <div class="dog-achievements-section">
                <h3 class="section-title-dog">OsiƒÖgniƒôcia</h3>
                <div class="achievements-content">
                    {{ dog.achievements|linebreaks }}
                </div>
            </div>
            {% endif %}

            <!-- Photos -->
            {% if dog.photos.all|length > 1 %}
            <div class="dog-gallery-section">
                <h3 class="section-title-dog">Galeria zdjƒôƒá</h3>
                <div class="gallery-grid-dog">
                    {% for photo in dog.photos.all %}
                        {% if photo != dog.main_photo %}
                        <div class="gallery-item-dog">
                            <img src="{{ photo.image.url }}"
                                 alt="{{ dog.name }}"
                                 loading="lazy">
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Back button -->
            <div class="profile-actions-dog">
                <a href="{% url 'zwierzaki:DogList' %}" class="btn-back-dog">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M12 8a.5.5 0 0 1-.5.5H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5a.5.5 0 0 1 .5.5z"/>
                    </svg>
                    Powr√≥t do listy ps√≥w
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}